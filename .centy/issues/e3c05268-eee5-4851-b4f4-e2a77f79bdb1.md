---
displayNumber: 3
status: in-progress
priority: 2
createdAt: 2026-02-05T20:00:24.312136+00:00
updatedAt: 2026-02-05T20:17:38.064022+00:00
---

# Add E2E tests running in containers for Linux and Windows

## Summary

Create end-to-end tests that verify the full centy-daemon installation pipeline (download from GitHub, SHA256 checksum verification, archive extraction, binary installation) running in Docker containers for Linux and natively on Windows CI runners.

## Implementation

### Rust Integration Test (`lib/tests/e2e_install.rs`)

* `install_pinned_version` — install a known version (e.g. v0.1.6), verify binary at ~/.centy/bin/centy-daemon, check non-empty, check executable perms on Unix
* `install_latest_version` — install with None, verify binary exists
* `install_version_without_v_prefix` — pass “0.1.6”, verify library normalizes it
* `install_nonexistent_version_fails` — pass v99.99.99, verify error returned
* Run with –test-threads=1 (shared install path), each test cleans up before running

### Linux Container (`e2e/Dockerfile.linux`)

* Based on rust:1.84-slim-bookworm
* Install pkg-config, libssl-dev, ca-certificates for reqwest TLS
* Create non-root testuser for realistic home directory testing
* Copy lib/ sources, build and run e2e tests

### Windows (native runner, no container)

* Run directly on windows-latest GitHub Actions runner
* Install Rust via dtolnay/rust-toolchain@stable
* Run cargo test –test e2e_install

### GitHub Actions workflow (`.github/workflows/e2e.yml`)

* Trigger on push/PR to main
* e2e-linux job: ubuntu-latest, build Dockerfile.linux, run in container
* e2e-windows job: windows-latest, run cargo test directly
* Cargo caching on Windows
* Concurrency group to cancel superseded runs

### Additional

* Add dirs = “6” to \[dev-dependencies\] in Cargo.toml
* Add e2e/run-linux.sh convenience script for local development

## Dependencies

* Depends on fixing the asset URL v-prefix bug (#58b2df28) — without that fix, all E2E tests will 404
