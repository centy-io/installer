---
displayNumber: 2
status: in-progress
priority: 1
createdAt: 2026-02-05T19:56:58.279465+00:00
updatedAt: 2026-02-05T20:00:25.840054+00:00
---

# Enforce strict Clippy linting and no-panic policy with Husky pre-push hook

Enforce the strictest possible Clippy linting rules on the centy-installer library and add a Husky pre-push hook to gate pushes on lint compliance. The library must never panic — all code paths must use proper Result-based error handling.

## Motivation

As a library that gets embedded into other tools, centy-installer must be rock-solid. Panics in library code crash the consumer’s process with no recourse. Strict linting catches bugs, enforces idioms, and prevents unsafe patterns from creeping in.

## Requirements

### 1. Strict Clippy configuration

Add a workspace-level Clippy configuration with the most restrictive lint groups:

* deny(clippy::all) — catch all default Clippy warnings as errors
* deny(clippy::pedantic) — enforce pedantic Rust idioms
* deny(clippy::nursery) — enable nursery lints for additional coverage
* deny(clippy::unwrap_used) — forbid .unwrap() in non-test code
* deny(clippy::expect_used) — forbid .expect() in non-test code
* deny(clippy::panic) — forbid panic!() in non-test code
* deny(clippy::unreachable) — forbid unreachable!() in non-test code
* Consider deny(clippy::cargo) for Cargo.toml hygiene

Allow these lints only in #\[cfg(test)\] modules where panicking is acceptable.

### 2. No-panic policy for production code

Audit all source files and ensure:

* No .unwrap() calls outside of #\[cfg(test)\] — currently the production code looks clean, but this must be enforced via lint
* No .expect() calls outside of #\[cfg(test)\]
* No panic!() / unreachable!() / todo!() outside of #\[cfg(test)\]
* Every fallible operation returns a Result and propagates errors via ? or explicit mapping

### 3. Husky pre-push hook

Add a .husky/pre-push hook (alongside the existing pre-commit hook) that runs:

cargo clippy –manifest-path lib/Cargo.toml – -D warnings
cargo test –manifest-path lib/Cargo.toml

This prevents pushing code that doesn’t pass the strictest lint checks or has failing tests.

### 4. Fix any new warnings

Enabling pedantic/nursery lints will likely surface new warnings. These should be fixed or explicitly #\[allow(…)\]’d with a justification comment where the lint is a false positive.

## Current state

* Husky: Only has a pre-commit hook running pnpm spellcheck
* Clippy: No custom configuration — using defaults only
* Production code: Already mostly clean (uses Result throughout), but not enforced by lints
* Test code: Uses .unwrap() and panic!() freely (which is fine and should remain allowed)

## Acceptance criteria

* [ ] Clippy runs with deny on all, pedantic, nursery, unwrap_used, expect_used, panic groups
* [ ] All production code compiles clean under strict lints (no #\[allow\] without justification)
* [ ] Test code is exempt from no-panic lints
* [ ] .husky/pre-push hook runs cargo clippy – -D warnings and cargo test
* [ ] CI (if applicable) mirrors the same lint checks
